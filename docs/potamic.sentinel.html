<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>potamic.sentinel documentation</title><link rel="stylesheet" type="text/css" href="css/highlight.css" /><link id="theme-style" rel="stylesheet" type="text/css" href="css/theme-light.css" /><link id="highlight-style" rel="stylesheet" type="text/css" href="css/highlight-googlecode.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1><div id="theme-selector"><span class="theme-label">Theme</span><div id="select-theme-light" class="select-theme">Light</div><div id="select-theme-dark" class="select-theme">Dark</div></div></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>potamic</span></div></div></li><li class="depth-2"><a href="potamic.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-3"><a href="potamic.db.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2"><a href="potamic.errors.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>errors</span></div></a></li><li class="depth-3 branch"><a href="potamic.errors.types.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>types</span></div></a></li><li class="depth-3"><a href="potamic.errors.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="potamic.fmt.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>fmt</span></div></a></li><li class="depth-2"><a href="potamic.queue.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>queue</span></div></a></li><li class="depth-3 branch"><a href="potamic.queue.queues.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>queues</span></div></a></li><li class="depth-3"><a href="potamic.queue.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 current"><a href="potamic.sentinel.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>sentinel</span></div></a></li><li class="depth-3"><a href="potamic.sentinel.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li><li class="depth-2 branch"><a href="potamic.util.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="potamic.validation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validation</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="potamic.sentinel.html#var-create-sentinel"><div class="inner"><span>create-sentinel</span></div></a></li><li class="depth-1"><a href="potamic.sentinel.html#var-SentinelProtocol"><div class="inner"><span>SentinelProtocol</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-frequency"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-frequency</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-handler"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-handler</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-init-id"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-init-id</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-queue-conn"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-queue-conn</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-queue-group"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-queue-group</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-queue-name"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-queue-name</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-signal-channel"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-signal-channel</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-start-offset"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-start-offset</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-state"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-state</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-get-sentinel-state-attr"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>get-sentinel-state-attr</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-set-sentinel-state-attr"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>set-sentinel-state-attr</span></div></a></li><li class="depth-2 branch"><a href="potamic.sentinel.html#var-start-sentinel.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>start-sentinel!</span></div></a></li><li class="depth-2"><a href="potamic.sentinel.html#var-stop-sentinel.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stop-sentinel!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">potamic.sentinel</h1><h4 class="added">added in 0.1</h4><div class="doc"><div class="markdown"><p>Provides time-oriented “watchers” for Potamic queues.</p>
</div></div><div class="public anchor" id="var-create-sentinel"><h3>create-sentinel</h3><div class="usage"><code>(create-sentinel {:keys [queue-uri queue-name queue-group init-id frequency start-offset handler], :or {start-offset 0, init-id 0}})</code></div><div class="doc"><div class="markdown"><p>Returns a new <code>Sentinel</code> record. Once created, use the Sentinel’s methods to retrieve config and to manage state.</p>
<p><strong>Configuration Options:</strong></p>
<table>
<thead>
<tr><th> Option         </th><th> Description             </th><th> Required </th><th> Default </th></tr>
</thead>
<tbody>
<tr><td> <code>queue-uri</code>    </td><td> Redis URI               </td><td> ✓  </td><td> none    </td></tr>
<tr><td> <code>queue-name</code>   </td><td> key name                </td><td> ✓  </td><td> none    </td></tr>
<tr><td> <code>queue-group</code>  </td><td> Consumer Group          </td><td> ✓  </td><td> none    </td></tr>
<tr><td> <code>init-id</code>      </td><td> starting stream ID      </td><td>          </td><td> 0       </td></tr>
<tr><td> <code>frequency</code>    </td><td> (ns) interval to run at </td><td> ✓  </td><td> none    </td></tr>
<tr><td> <code>start-offset</code> </td><td> ms to wait to start     </td><td>          </td><td> 0       </td></tr>
<tr><td> <code>handler</code>      </td><td> 1-artity fn of <code>this</code>   </td><td> ✓  </td><td> none    </td></tr>
</tbody>
</table>
<p><strong>State:</strong></p>
<table>
<thead>
<tr><th> Attr        </th><th> Type    </th><th> Description                                    </th></tr>
</thead>
<tbody>
<tr><td> <code>:started?</code> </td><td> boolean </td><td> set on <code>q/start-sentinel!</code>/<code>q/stop-sentinel!</code>  </td></tr>
<tr><td> <code>:stopped?</code> </td><td> boolean </td><td> set on <code>q/start-sentinel!</code>/<code>q/stop-sentinel!</code>  </td></tr>
<tr><td> <code>:n-runs</code>   </td><td> int     </td><td> increments for every interation at <code>frequency</code> </td></tr>
</tbody>
</table>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler
          (fn [this]
            (println "RUN:" (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/SentinelProtocol</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-SentinelProtocol"><h3>SentinelProtocol</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol for Sentinel.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-get-sentinel-frequency"><h3>get-sentinel-frequency</h3><div class="usage"><code>(get-sentinel-frequency this)</code></div><div class="doc"><div class="markdown"><p>Returns frequency for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-frequency s)
;= 2000
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-handler"><h3>get-sentinel-handler</h3><div class="usage"><code>(get-sentinel-handler this)</code></div><div class="doc"><div class="markdown"><p>Returns handler for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-handler s)
;= #function[user/fn--37246]
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-init-id"><h3>get-sentinel-init-id</h3><div class="usage"><code>(get-sentinel-init-id this)</code></div><div class="doc"><div class="markdown"><p>Returns init-id for Sentinel.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-init-id s)
;= 0
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-queue-conn"><h3>get-sentinel-queue-conn</h3><div class="usage"><code>(get-sentinel-queue-conn this)</code></div><div class="doc"><div class="markdown"><p>Returns queue connection for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-queue-conn s)
;= {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=  :pool
;=  #taoensso.carmine.connections.ConnectionPool
;=  {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool[..]
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-queue-group"><h3>get-sentinel-queue-group</h3><div class="usage"><code>(get-sentinel-queue-group this)</code></div><div class="doc"><div class="markdown"><p>Returns queue group for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-queue-group s)
;= my/group
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-queue-name"><h3>get-sentinel-queue-name</h3><div class="usage"><code>(get-sentinel-queue-name this)</code></div><div class="doc"><div class="markdown"><p>Returns queue name for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-queue-name s)
;= my/queue
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-signal-channel"><h3>get-sentinel-signal-channel</h3><div class="usage"><code>(get-sentinel-signal-channel this)</code></div><div class="doc"><div class="markdown"><p>Returns signal channel for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-signal-channel s)
;= #object[clojure.core.async.impl.channels.ManyToManyChannel
;=         0x44973096
;=         "clojure.core.async.impl.channels.ManyToManyChannel@44973096"]
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-start-offset"><h3>get-sentinel-start-offset</h3><div class="usage"><code>(get-sentinel-start-offset this)</code></div><div class="doc"><div class="markdown"><p>Returns start offset for Sentinel.</p>
<p><em>NOTE</em>: This value is immutable.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-start-offset s)
;= 0
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-state"><h3>get-sentinel-state</h3><div class="usage"><code>(get-sentinel-state this)</code></div><div class="doc"><div class="markdown"><p>Returns all state for Sentinel.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-state s)
;= {:started? false, :stopped? false, :n-runs 0}

(do (q/start-sentinel! s) nil)
;= 2023-06-30T17:06:26.341Z m INFO [potamic.sentinel:618] - \
;= [potamic.sentinel] Started Sentinel for  my/queue
;= nil
;= RUN: 1
;= RUN: 2
;= RUN: 3

(q/get-sentinel-state s)
;= {:started? true, :stopped? false, :n-runs 4}

(q/stop-sentinel! s)
;= true
;= 2023-06-30T17:06:39.462Z m INFO [potamic.sentinel:628] - \
;= [potamic.sentinel] Stopped Sentinel for  my/queue

(q/get-sentinel-state s)
;= {:started? false, :stopped? true, :n-runs 7}
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-get-sentinel-state-attr"><h3>get-sentinel-state-attr</h3><div class="usage"><code>(get-sentinel-state-attr this attr)</code></div><div class="doc"><div class="markdown"><p>Returns specific state attr for Sentinel.</p>
<p><strong>State:</strong></p>
<table>
<thead>
<tr><th> Attr        </th><th> Type    </th><th> Description                                    </th></tr>
</thead>
<tbody>
<tr><td> <code>:started?</code> </td><td> boolean </td><td> set on <code>q/start-sentinel!</code>/<code>q/stop-sentinel!</code>  </td></tr>
<tr><td> <code>:stopped?</code> </td><td> boolean </td><td> set on <code>q/start-sentinel!</code>/<code>q/stop-sentinel!</code>  </td></tr>
<tr><td> <code>:n-runs</code>   </td><td> int     </td><td> increments for every interation at <code>frequency</code> </td></tr>
</tbody>
</table>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/get-sentinel-state-attr s :started?)
;= false

(do (q/start-sentinel! s) nil)
;= 2023-06-30T17:06:26.341Z m INFO [potamic.sentinel:618] - \
;= [potamic.sentinel] Started Sentinel for  my/queue
;= nil
;= RUN: 1
;= RUN: 2
;= RUN: 3

(q/get-sentinel-state-attr s :started?)
;= true
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-set-sentinel-state-attr"><h3>set-sentinel-state-attr</h3><div class="usage"><code>(set-sentinel-state-attr this k v)</code></div><div class="doc"><div class="markdown"><p>Sets k to v in state atom. Returns Sentinel. This is primarily intended to be used to track encapsulated user state through a Sentinel’s lifetime.</p>
<p><strong>Built-in State:</strong></p>
<table>
<thead>
<tr><th> Attr        </th><th> Type    </th><th> Description                                    </th></tr>
</thead>
<tbody>
<tr><td> <code>:started?</code> </td><td> boolean </td><td> set on <code>q/start-sentinel!</code>/<code>q/stop-sentinel!</code>  </td></tr>
<tr><td> <code>:stopped?</code> </td><td> boolean </td><td> set on <code>q/start-sentinel!</code>/<code>q/stop-sentinel!</code>  </td></tr>
<tr><td> <code>:n-runs</code>   </td><td> int     </td><td> increments for every interation at <code>frequency</code> </td></tr>
</tbody>
</table>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/set-sentinel-state-attr s :process-count 52)
;= #potamic.sentinel.Sentinel
;= {:queue-conn {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=               :pool #taoensso.carmine.connections.ConnectionPool[..]}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--37246]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel[..]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0
;=                :process-count 52}
;=               0x2a042d0a]}

(q/get-sentinel-state-attr s :process-count)
;= 52
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-start-sentinel.21"><h3>start-sentinel!</h3><div class="usage"><code>(start-sentinel! this)</code></div><div class="doc"><div class="markdown"><p>Starts a <code>Sentinel</code>. Returns modified Sentinal ("this ") after instantiation.</p>
<p>This method has side effects:</p>
<ol>
<li>It will create the queue (stream) if it doesn’t exist.</li>
<li>It logs a message, stating it has started.</li>
<li>It mutates its own internal <code>:state</code> atom.</li>
<li>It launches a go loop (via core.async thread pool)</li>
<li>It can only be stopped by <code>potamic.sentinel/stop-sentinel!</code> or crashing.</li>
</ol>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/start-sentinel! s)
;= 2023-06-21T19:01:45.533Z m INFO [potamic.sentinel:252] \
;=   - [potamic.sentinel] Started Sentinel for  my/queue
;= #potamic.sentinel.Sentinel {:queue-conn [..]
;=                     :queue-name my/queue
;=                     :queue-group my/group
;=                     [..]}
;= RUN: 1
;= RUN: 2
;= RUN: 3
;= [...]
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/stop-sentinel!</code></li>
</ul>
</div></div></div><div class="public anchor" id="var-stop-sentinel.21"><h3>stop-sentinel!</h3><div class="usage"><code>(stop-sentinel! this)</code></div><div class="doc"><div class="markdown"><p>Stops Sentinel.</p>
<p>Examples:</p>
<pre><code class="language-clojure">(require '[potamic.sentinel :as q])

(def s (q/create-sentinel
         {:queue-uri "redis://default:secret@localhost:6379/0"
          :queue-name 'my/queue
          :queue-group 'my/group
          :frequency 2000
          :handler (fn [this]
                     (println "RUN:"
                       (q/get-sentinel-state-attr this :n-runs)))}))
;= #potamic.sentinel.Sentinel
;= {:queue-conn
;=  {:spec {:uri "redis://default:secret@localhost:6379/0"}
;=   :pool #taoensso.carmine.connections.ConnectionPool
;=   {:pool #object[org.apache.commons.pool2.impl.GenericKeyedObjectPool]}}
;=  :queue-name my/queue
;=  :queue-group my/group
;=  :init-id 0
;=  :frequency 2000
;=  :start-offset 0
;=  :handler #function[user/fn--33742]
;=  :signal-chan
;=  #object[clojure.core.async.impl.channels.ManyToManyChannel]
;=  :state #atom[{:started? false
;=                :stopped? false
;=                :n-runs 0} 0x217abcc9]}

(q/start-sentinel! s)
;= 2023-06-21T19:01:45.533Z m INFO [potamic.sentinel:252] \
;=   - [potamic.sentinel] Started Sentinel for  my/queue
;= #potamic.sentinel.Sentinel {:queue-conn [..]
;=                     :queue-name my/queue
;=                     :queue-group my/group
;=                     [..]}
;= RUN: 1
;= RUN: 2
;= RUN: 3
;= [...]

(q/stop-sentinel! s)
;= true
;= 2023-06-21T19:01:58.466Z m INFO [potamic.sentinel:262] \
;=   - [potamic.sentinel] Stopped Sentinel for  my/queue
</code></pre>
<p>See also:</p>
<ul>
<li><code>potamic.sentinel/create-sentinel</code></li>
<li><code>potamic.sentinel/get-sentinel-init-id</code></li>
<li><code>potamic.sentinel/get-sentinel-frequency</code></li>
<li><code>potamic.sentinel/get-sentinel-start-offset</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-conn</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-name</code></li>
<li><code>potamic.sentinel/get-sentinel-queue-group</code></li>
<li><code>potamic.sentinel/get-sentinel-handler</code></li>
<li><code>potamic.sentinel/get-sentinel-signal-channel</code></li>
<li><code>potamic.sentinel/get-sentinel-state</code></li>
<li><code>potamic.sentinel/get-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/set-sentinel-state-attr</code></li>
<li><code>potamic.sentinel/start-sentinel!</code></li>
</ul>
</div></div></div></div></div></div></div></body></html>